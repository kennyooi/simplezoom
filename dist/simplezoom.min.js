/*! simplezoom 09-06-2015 */
!function(a){function b(b,d){if(this.$el=a(b),this.options=a.extend(!0,{},c,d,this.$el.data()),this.$img=this.$el.find(this.options.imgclass),0!==this.$img.length&&(this.$img=this.$img.first(),this.img_lg=this.$el.attr("href"),this.img_sm=this.$img.attr("src"),this.img_lg&&this.img_sm&&"#"!=this.img_lg)){var e=this;this.$el.on("click.simplezoom",function(a){a.preventDefault(),e.showModal()})}}var c={classie:"",offset:40,scrollclose:!0,imgclass:"img",duration:0,modalTmpl:null,loaderTmpl:null},d='<div class="modal-simplezoom modal"><div class="modal-bg"></div><div class="modal-content"><div class="simplezoom-item"><img src="{{img}}" alt="simplezoom-img" /></div></div></div>',e='<div class="simplezoom-loader loader"><i></i></div>';a.extend(b.prototype,{showModal:function(){var b=this,c=null;this.$modal=this.createModal(this.img_sm),this.$content=this.$modal.find(".simplezoom-item"),this.setInitPosition(),this.options.duration&&this.$content.css("transitionDuration",this.options.duration+"ms"),this.$img.css("visibility","hidden"),this.loadImageMeta(this.img_sm,function(d){b.$modal&&!b.isClosing&&(b.setFullPosition(d),b.$content.append(b.options.loaderTmpl||e),b.$modal.addClass("in loading"),b.loadImageMeta(b.img_lg,function(a){b.$modal&&!b.isClosing&&(b.$modal.removeClass("loading"),a&&(b.$content.find("img").attr("src",b.img_lg),b.setFullPosition(a),b.evtTrigger("onImageLoaded")))}),a(window).on("resize.simplezoom",function(a){clearTimeout(c),c=setTimeout(function(){b.setFullPosition(d)},100)}),b.$modal.on("click",function(a){b.closeModal()}),b.options.scrollclose&&a(window).on("scroll.simplezoom",function(a){b.closeModal()}))}),b.evtTrigger("onModalInit")},closeModal:function(){var b=this;this.isClosing=!0,this.$modal.removeClass("in"),this.$content.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){b.$modal.remove(),b.$modal=null,b.$img.css("visibility","visible"),a(window).off("resize.simplezoom").off("scroll.simplezoom"),b.isClosing=!1}),this.setInitPosition(),this.evtTrigger("onModalClosed")},createModal:function(b){var c=this.options.modalTmpl||d;return c=c.replace("{{img}}",b),a(c).addClass(this.options.classie).appendTo("body")},setInitPosition:function(){var b={width:this.$img.width(),height:this.$img.height(),left:this.$img.offset().left,top:this.$img.offset().top-a(window).scrollTop()};this.$content.css(b)},setFullPosition:function(b){var c,d,e,f,g,h,i,j;c=b.w,d=b.h,g=c/d,e=a(window).width()-2*this.options.offset,f=a(window).height()-2*this.options.offset,h=e/f,h>g?(d=Math.min(f,d),c=d*g):(c=Math.min(e,c),d=c/g),i=(a(window).width()-c)/2,j=(a(window).height()-d)/2,this.$content.css({width:c,height:d,left:i,top:j})},loadImageMeta:function(b,c){var d=this;a("<img />").load(function(){c({w:this.width,h:this.height})}).error(function(){d.evtTrigger("onImageError"),c(null)}).attr("src",b)},evtTrigger:function(a){a&&this.options[a]&&"function"==typeof this.options[a]&&this.options[a].call(this,this.$el,this.$modal)}}),a.fn.simplezoom=function(c){var d="iws_simplezoom";return this.each(function(){var e=a.data(this,d);e||(e=new b(this,c),a.data(this,d,e))})}}(jQuery);